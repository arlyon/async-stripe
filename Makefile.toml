[tasks.openapi-delete]
cwd = "openapi"
command = "rm"
args = ["-rf", "spec3.sdk.json", "out"]

[tasks.openapi-generate-no-fetch]
cwd = "openapi"
command = "cargo"
args = ["run", "spec3.sdk.json"]

[tasks.openapi-generate]
cwd = "openapi"
command = "cargo"
args = ["run", "spec3.sdk.json", "--fetch", "current"]
dependencies = ["openapi-delete-out"]

[tasks.openapi-generate-latest]
cwd = "openapi"
command = "cargo"
args = ["run", "spec3.sdk.json", "--fetch", "latest"]
dependencies = ["openapi-delete-out"]

[tasks.openapi-copy]
cwd = "openapi"
command = "rsync"
# --delete so that generated files don't stick around when not
# generated anymore, see https://github.com/arlyon/async-stripe/issues/229
args = ["-a", "--delete-during", "out/", "../src/resources/generated"]

[tasks.fmt]
command = "cargo"
toolchain = "nightly"
install_crate = "rustfmt"
# we set this to true because missing files currently cause rustfmt to fail
# which impacts our weekly CI job 
ignore_errors = true 
args = ["fmt"]

[tasks.check]
command = "cargo"
toolchain = "nightly"
install_crate = "rustfmt"
args = ["fmt", "--", "--check"]

[tasks.openapi-install]
dependencies = ["openapi-generate", "openapi-copy", "fmt"]

[tasks.openapi-install-latest]
dependencies = ["openapi-generate-latest", "openapi-copy", "fmt"]

[tasks.openapi-install-no-fetch]
dependencies = ["openapi-generate-no-fetch", "openapi-copy", "fmt"]

[config]
default_to_workspace = false

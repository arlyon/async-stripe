---
title: Error Handling
description: Understanding and handling Stripe API errors effectively
icon: TriangleAlert
---

import { Callout } from "fumadocs-ui/components/callout"
import { CodeFromFile } from "@/components/code-from-file"

Stripe API requests can fail for various reasons: invalid parameters, authentication issues, card declines, rate limits, and network failures. The `StripeError` enum provides structured error information to help you handle these cases appropriately.

## Error Types

The `StripeError` enum has several variants:

<CodeFromFile
  file="async-stripe/src/error.rs"
  href={{base: "https://github.com/arlyon/async-stripe/blob/master/"}}
  lang="rust"
  startLine={7}
  endLine={25}
  dedent
/>

## Handling API Errors

The most common error type is `StripeError::Stripe`, which contains the error details from Stripe's API along with the HTTP status code.

### Basic Error Handling

<CodeFromFile
  file="examples/error-handling-basic.rs"
  href={{base: "https://github.com/arlyon/async-stripe/blob/master/"}}
  lang="rust"
  startLine={17}
  endLine={30}
  dedent
/>

### Handling Specific HTTP Status Codes

Different status codes indicate different types of failures:

<CodeFromFile
  file="examples/error-handling-status-codes.rs"
  href={{base: "https://github.com/arlyon/async-stripe/blob/master/"}}
  lang="rust"
  startLine={20}
  endLine={67}
  dedent
/>

## Common Error Codes

Stripe includes error codes in the `ApiErrors` struct that provide more specific information about what went wrong:

### Payment Errors (402)

- `card_declined` - The card was declined
- `expired_card` - The card has expired
- `incorrect_cvc` - The CVC is incorrect
- `processing_error` - An error occurred while processing the card
- `insufficient_funds` - Insufficient funds in the account

### Request Errors (400)

- `parameter_invalid_empty` - A required parameter was empty
- `parameter_unknown` - An unknown parameter was provided
- `resource_missing` - The requested resource doesn't exist

### Authentication Errors (401)

- `invalid_api_key` - The API key is invalid

<Callout type="info">
For a complete list of error codes, see the [Stripe Error Codes documentation](https://stripe.com/docs/error-codes).
</Callout>

## Retry Strategies

For transient errors (network issues, server errors), use the built-in retry strategies:

<CodeFromFile
  file="examples/error-handling-retry.rs"
  href={{base: "https://github.com/arlyon/async-stripe/blob/master/"}}
  lang="rust"
  startLine={16}
  endLine={29}
  highlightLines={[2]}
  dedent
/>

See the [Request Strategies](/docs/request-strategy) documentation for more details on retry behavior.

## Best Practices

### 1. Handle Specific Errors

Don't just log all errors the same way. Handle payment failures differently from configuration errors:

<CodeFromFile
  file="examples/error-handling-best-practices.rs"
  href={{base: "https://github.com/arlyon/async-stripe/blob/master/"}}
  lang="rust"
  startLine={36}
  endLine={53}
  dedent
/>

### 2. Use Idempotency Keys

For critical operations (especially payment creation), always use idempotency keys to prevent accidental duplicate charges:

<CodeFromFile
  file="examples/error-handling-best-practices.rs"
  href={{base: "https://github.com/arlyon/async-stripe/blob/master/"}}
  lang="rust"
  startLine={64}
  endLine={78}
  dedent
/>

### 3. Log Error Details

The `ApiErrors` struct contains useful debugging information:

<CodeFromFile
  file="examples/error-handling-best-practices.rs"
  href={{base: "https://github.com/arlyon/async-stripe/blob/master/"}}
  lang="rust"
  startLine={83}
  endLine={94}
  dedent
/>

### 4. Don't Retry Client Errors

4xx errors (except 429 rate limits) usually indicate a problem with your request that won't be fixed by retrying. Only retry 5xx server errors and network failures.

The built-in `RequestStrategy::ExponentialBackoff` handles this correctly for you.

<Callout type="warn">
Never retry failed payments without user confirmation. A failed payment could be intentional (e.g., user canceled) or indicate fraud prevention.
</Callout>
